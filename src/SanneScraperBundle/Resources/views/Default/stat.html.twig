{% extends 'SanneScraperBundle:Default:base.html.twig'  %}
{% block body %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Sanne's Media Consumption</h3>
        </div>
        <div class="panel-body">
            
            <style>
                html, body {
                    width: 100%;
                    height: 100%;
                    margin: 0px;
                    border: 0px;
                    border: 0px;
                }
                
                .boop {
                    width: 450px;
                    height: 450px;
                    margin: 5px ;
                    padding: 5px;
                }
                
              
                
            </style>

            <script>
                $.get("/sanne/get/years", function(data){
                    //console.log(data);
                    //TODO: populate the years list with this, for fun & foo
                }
                );
        
            </script>
            
            
            <!-- todo this row should be inside a row, or a much smaller container -->
            <div class="row" border='1'>
                <div class="col-md-2 col-sm-3 col-xs-7 col-lg-2" >
                    <div class="form-group" wxidth="200px">
                        <select class="form-control" id="sel1">
                            {% for year in years %}
                            <option>{{year}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-1 col-sm-1 col-xs-4 col-lg-1" >
                    <a id="download">
                        <button type="button" class="btn btn-primary">Download</button>
                    </a>
                </div>
            </div>
                        
            <!--
             The idea is to separate this out as a view that gets returned on an API call  
            -->
            <div class="row"  >
                <div class="boop" id="boop" >
                    <canvas id="myChart" width="500" height="500"></canvas>
                </div>
                <script>
                    var ctx = document.getElementById("myChart").getContext('2d');
                    var data = {
                        labels: ['jan', 'feb', 'march', 'april', 'may', 'june', 'july', 'aug', 'sep', 'oct', 'nov', 'dec'],
                        datasets: [{
                                borderWidth: 5,
                        label: "Books ", // + {{results[1].getData()}} ,
                                data:{{ results[1].getData() }},
                                backgroundColor: ['rgba(0,206,209,0.8)']
                        }, {
                        label: ' Movies',// + {{results[0].getData()}} ,
                                data:{{ results[0].getData() }},
                                backgroundColor: ['rgba(205,92,92,0.8)']
                        }
                        ]
                    };
                    var chartInstance = new Chart(ctx, {
                        type: 'line',
                            data: data,
                            options: {
                                responsive: true,
                                maintainAspectRation: false,
                                title: {
                                    display: true,
                                    text: {{results[1].getYear}} ,
                                    padding: '1',
                                    fullWidth: true
                                },
                                scales: {
                                    yAxes: [{
                                            ticks: {
                                                stepSize: 1,
                                                max: 15
                                            }
                                    }]
                                }
                            }
                    });
                   
                   /**
                    * Original canvas download snippet thanks to
                    * Ken Fyrstenberg Nilsen
                    * https://jsfiddle.net/AbdiasSoftware/7PRNN/
                    */

                   /**
                    * This is the function that will take care of image extracting and
                    * setting proper filename for the download.
                    * IMPORTANT: Call it from within a onclick event.
                    */
                   function downloadCanvas(link, canvasId, filename) {
                       link.href = document.getElementById(canvasId).toDataURL();
                       link.download = filename;
                   }

                   /** 
                    * The event handler for the link's onclick event. We give THIS as a
                    * parameter (=the link element), ID of the canvas and a filename.
                   */
                   document.getElementById('download').addEventListener('click', function() {
                       downloadCanvas(this, 'myChart', '{{results[1].getYear}}.png');
                   }, false);
                    
                </script>
            </div>
        </div>
    </div>
{% endblock %}